<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Garage PRO | Mec√°nico IA 24/7</title>
    <meta name="description"
        content="Gesti√≥n profesional de tu veh√≠culo con IA. Dashboard, estad√≠sticas, alertas y mucho m√°s.">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîß</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="garage-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@500;700&display=swap"
        rel="stylesheet">

    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        /* ESTILOS ADICIONALES PARA GARAGE PRO */
        .garage-pro-header {
            background: linear-gradient(135deg, var(--primary) 0%, #1fa35a 100%);
            padding: 2rem;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .garage-pro-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(180deg);
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-glass);
            padding: 1.5rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(46, 213, 115, 0.2);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .chart-container {
            background: var(--bg-glass);
            padding: 2rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .alert-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            font-weight: 600;
            animation: pulse 2s ease-in-out infinite;
        }

        .alert-urgent {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid #ff4757;
        }

        .alert-warning {
            background: rgba(255, 165, 2, 0.2);
            color: #ffa502;
            border: 1px solid #ffa502;
        }

        .alert-info {
            background: rgba(46, 213, 115, 0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .achievement-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: var(--radius-full);
            color: white;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(240, 147, 251, 0.4);
            animation: bounce 1s ease-in-out;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .photo-item {
            aspect-ratio: 1;
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: var(--bg-glass);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .photo-item:hover {
            transform: scale(1.05);
            border-color: var(--primary);
        }

        .add-photo {
            border: 2px dashed var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-photo:hover {
            border-color: var(--primary);
            background: rgba(46, 213, 115, 0.1);
        }

        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--primary), transparent);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 2rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2.5rem;
            top: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid var(--bg-primary);
            box-shadow: 0 0 0 4px rgba(46, 213, 115, 0.2);
        }

        .dark-mode-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(46, 213, 115, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .dark-mode-toggle:hover {
            transform: scale(1.1) rotate(180deg);
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .tabs-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border);
            overflow-x: auto;
        }

        .tab-btn {
            padding: 1rem 2rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">
                <a href="index.html"
                    style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 1rem;">
                    <span class="logo-icon">üîß</span>
                    <span class="logo-text">Mec√°nico IA <span class="accent">24/7</span></span>
                </a>
            </div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html" class="nav-link">Inicio</a></li>
                <li><a href="index.html#diagnostico" class="nav-link">Diagn√≥stico</a></li>
                <li><a href="blog.html" class="nav-link">Blog</a></li>
                <li><a href="garage.html" class="nav-link active">Mi Garage PRO</a></li>
            </ul>
            <button class="menu-toggle" id="menuToggle" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Garage PRO Content -->
    <section class="module-section garage-module" style="padding-top: 120px; min-height: 100vh;">
        <div class="container">

            <!-- Header PRO -->
            <div class="garage-pro-header">
                <div style="position: relative; z-index: 1;">
                    <h1 class="module-title" style="color: white; margin-bottom: 0.5rem;">üöó Mi Garage PRO</h1>
                    <p style="color: rgba(255,255,255,0.9); font-size: 1.1rem;">Gesti√≥n profesional de tu veh√≠culo con
                        IA</p>
                    <div style="margin-top: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button onclick="openModal('vehicleModal')" class="btn btn-secondary"
                            style="background: white; color: var(--primary);">
                            ‚ûï A√±adir Veh√≠culo
                        </button>
                        <button onclick="exportGarageData()" class="btn btn-secondary"
                            style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white;">
                            üìä Exportar Datos
                        </button>
                    </div>
                </div>
            </div>

            <!-- Vehicle Selector -->
            <div style="margin-bottom: 2rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Selecciona tu veh√≠culo:</label>
                <select id="garageVehicleSelect"
                    style="width: 100%; max-width: 400px; padding: 1rem; border-radius: var(--radius-md); background: var(--bg-glass); border: 1px solid var(--border); color: var(--text-primary); font-size: 1rem;">
                    <option value="">-- Selecciona un veh√≠culo --</option>
                </select>
            </div>

            <!-- Empty State -->
            <div id="garageEmptyState" style="text-align: center; padding: 4rem 2rem; display: none;">
                <div style="font-size: 5rem; margin-bottom: 1rem;">üöó</div>
                <h2 style="margin-bottom: 1rem;">No tienes veh√≠culos registrados</h2>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">A√±ade tu primer veh√≠culo para empezar a
                    gestionar su mantenimiento</p>
                <button onclick="openModal('vehicleModal')" class="btn btn-primary">
                    ‚ûï A√±adir Mi Primer Veh√≠culo
                </button>
            </div>

            <!-- Dashboard (hidden by default) -->
            <div id="garageDashboard" style="display: none;">

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-icon">üìÖ</span>
                        <div class="stat-value" id="statDaysOwned">0</div>
                        <div class="stat-label">D√≠as contigo</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">üõ£Ô∏è</span>
                        <div class="stat-value" id="statTotalKm">0</div>
                        <div class="stat-label">Kil√≥metros totales</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">üí∞</span>
                        <div class="stat-value" id="statTotalCost">0‚Ç¨</div>
                        <div class="stat-label">Gasto total</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">üîß</span>
                        <div class="stat-value" id="statMaintenance">0</div>
                        <div class="stat-label">Mantenimientos</div>
                    </div>
                </div>

                <!-- Alerts Section -->
                <div id="alertsSection" style="margin-bottom: 2rem;"></div>

                <!-- Tabs -->
                <div class="tabs-container">
                    <button class="tab-btn active" onclick="switchTab('overview')">üìä Resumen</button>
                    <button class="tab-btn" onclick="switchTab('maintenance')">üîß Mantenimiento</button>
                    <button class="tab-btn" onclick="switchTab('history')">üìú Historial</button>
                    <button class="tab-btn" onclick="switchTab('costs')">üí∞ Costes</button>
                    <button class="tab-btn" onclick="switchTab('photos')">üì∏ Fotos</button>
                    <button class="tab-btn" onclick="switchTab('achievements')">üèÜ Logros</button>
                </div>

                <!-- Tab: Overview -->
                <div id="tab-overview" class="tab-content active">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">

                        <!-- Vehicle Info Card -->
                        <div class="chart-container">
                            <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span>üöó</span> Informaci√≥n del Veh√≠culo
                            </h3>
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--text-muted);">Modelo:</span>
                                    <span style="font-weight: 600;" id="statModel">-</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--text-muted);">A√±o:</span>
                                    <span style="font-weight: 600;" id="statYear">-</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--text-muted);">Kilometraje:</span>
                                    <span style="font-weight: 600;" id="statKm">-</span>
                                </div>
                                <div style="margin-top: 1rem;">
                                    <button onclick="openEditVehicleModal()" class="btn btn-secondary"
                                        style="width: 100%;">
                                        ‚úèÔ∏è Editar Veh√≠culo
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Health Score -->
                        <div class="chart-container">
                            <h3 style="margin-bottom: 1.5rem; text-align: center;">üíö Estado de Salud</h3>
                            <svg class="progress-ring" viewBox="0 0 120 120">
                                <circle cx="60" cy="60" r="54" stroke="rgba(46, 213, 115, 0.2)" stroke-width="12"
                                    fill="none" />
                                <circle id="healthCircle" class="progress-ring-circle" cx="60" cy="60" r="54"
                                    stroke="var(--primary)" stroke-width="12" fill="none" stroke-dasharray="339.292"
                                    stroke-dashoffset="0" />
                                <text x="60" y="60" text-anchor="middle" dy=".3em" font-size="24" font-weight="700"
                                    fill="var(--primary)" id="healthScore">100%</text>
                            </svg>
                            <p style="text-align: center; margin-top: 1rem; color: var(--text-secondary);">Basado en
                                mantenimientos al d√≠a</p>
                        </div>

                        <!-- 3D Car Viewer -->
                        <div class="chart-container" style="grid-column: 1 / -1;">
                            <h3 style="margin-bottom: 1.5rem;">üé® Vista 3D del Veh√≠culo</h3>
                            <div class="visual-car-container"
                                style="height: 400px; background: linear-gradient(135deg, rgba(46, 213, 115, 0.1) 0%, rgba(31, 163, 90, 0.1) 100%); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                                <iframe title="Cupra Formentor 2021" frameborder="0" allowfullscreen
                                    mozallowfullscreen="true" webkitallowfullscreen="true"
                                    allow="autoplay; fullscreen; xr-spatial-tracking" xr-spatial-tracking
                                    execution-while-out-of-viewport execution-while-not-rendered web-share
                                    src="https://sketchfab.com/models/fbb89efad34e4e7983234f7c95742413/embed?autostart=1&ui_theme=dark&transparent=1"
                                    style="width: 100%; height: 100%; border: none;"></iframe>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Maintenance -->
                <div id="tab-maintenance" class="tab-content">
                    <div class="chart-container">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3>üîß Pr√≥ximos Mantenimientos</h3>
                            <button onclick="openModal('logModal')" class="btn btn-primary">
                                ‚ûï A√±adir Registro
                            </button>
                        </div>
                        <div id="maintenanceList"></div>
                    </div>
                </div>

                <!-- Tab: History -->
                <div id="tab-history" class="tab-content">
                    <div class="chart-container">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3>üìú Historial Completo</h3>
                            <div style="display: flex; gap: 0.5rem;">
                                <select id="historyFilter" onchange="filterHistory()"
                                    style="padding: 0.5rem; border-radius: var(--radius-md); background: var(--bg-glass); border: 1px solid var(--border); color: var(--text-primary);">
                                    <option value="all">Todos</option>
                                    <option value="mantenimiento">Mantenimiento</option>
                                    <option value="averia">Aver√≠as</option>
                                    <option value="modificacion">Modificaciones</option>
                                    <option value="taller">Taller</option>
                                </select>
                                <button onclick="openModal('logModal')" class="btn btn-primary">
                                    ‚ûï A√±adir
                                </button>
                            </div>
                        </div>
                        <div class="timeline" id="historyList"></div>
                    </div>
                </div>

                <!-- Tab: Costs -->
                <div id="tab-costs" class="tab-content">
                    <div class="chart-container">
                        <h3 style="margin-bottom: 1.5rem;">üí∞ An√°lisis de Costes</h3>
                        <canvas id="costsChart" style="max-height: 400px;"></canvas>
                    </div>
                    <div class="chart-container" style="margin-top: 2rem;">
                        <h3 style="margin-bottom: 1.5rem;">üìä Distribuci√≥n de Gastos</h3>
                        <canvas id="costsDistributionChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>

                <!-- Tab: Photos -->
                <div id="tab-photos" class="tab-content">
                    <div class="chart-container">
                        <h3 style="margin-bottom: 1.5rem;">üì∏ Galer√≠a de Fotos</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Guarda fotos de tu veh√≠culo,
                            modificaciones y reparaciones</p>
                        <div class="photo-gallery" id="photoGallery">
                            <div class="photo-item add-photo"
                                onclick="alert('üì∏ Funci√≥n de subir fotos pr√≥ximamente. Por ahora puedes a√±adir emojis de coches: üöóüöôüöïüèéÔ∏è')">
                                <span>‚ûï</span>
                            </div>
                            <div class="photo-item">üöó</div>
                            <div class="photo-item">üîß</div>
                            <div class="photo-item">üí®</div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Achievements -->
                <div id="tab-achievements" class="tab-content">
                    <div class="chart-container">
                        <h3 style="margin-bottom: 1.5rem;">üèÜ Tus Logros</h3>
                        <div style="display: grid; gap: 1rem;" id="achievementsList">
                            <div class="achievement-badge">
                                <span>üéâ</span>
                                <span>Primer Veh√≠culo Registrado</span>
                            </div>
                            <div class="achievement-badge"
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <span>üîß</span>
                                <span>Mantenimiento al D√≠a</span>
                            </div>
                            <div class="achievement-badge"
                                style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <span>üìù</span>
                                <span>Historial Completo</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Modals (same as before but improved) -->
    <!-- Add Vehicle Modal -->
    <div id="vehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï A√±adir Veh√≠culo</h2>
                <button class="modal-close" onclick="closeModal('vehicleModal')">‚úï</button>
            </div>
            <form id="addVehicleForm">
                <div class="form-group">
                    <label>Marca</label>
                    <input type="text" id="vehicleBrand" required placeholder="Ej: Toyota">
                </div>
                <div class="form-group">
                    <label>Modelo</label>
                    <input type="text" id="vehicleModel" required placeholder="Ej: Corolla">
                </div>
                <div class="form-group">
                    <label>A√±o</label>
                    <input type="number" id="vehicleYear" required min="1900" max="2025" placeholder="2020">
                </div>
                <div class="form-group">
                    <label>Kilometraje Actual</label>
                    <input type="number" id="vehicleMileage" required min="0" placeholder="50000">
                </div>
                <div class="form-group">
                    <label>Tipo</label>
                    <select id="vehicleType">
                        <option value="sedan">Sed√°n</option>
                        <option value="suv">SUV</option>
                        <option value="hatchback">Hatchback</option>
                        <option value="coupe">Coup√©</option>
                        <option value="truck">Camioneta</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">A√±adir Veh√≠culo</button>
            </form>
        </div>
    </div>

    <!-- Edit Vehicle Modal -->
    <div id="editVehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Editar Veh√≠culo</h2>
                <button class="modal-close" onclick="closeModal('editVehicleModal')">‚úï</button>
            </div>
            <form id="editVehicleForm">
                <input type="hidden" id="editVehicleId">
                <div class="form-group">
                    <label>Marca</label>
                    <input type="text" id="editVehicleBrand" required>
                </div>
                <div class="form-group">
                    <label>Modelo</label>
                    <input type="text" id="editVehicleModel" required>
                </div>
                <div class="form-group">
                    <label>A√±o</label>
                    <input type="number" id="editVehicleYear" required min="1900" max="2025">
                </div>
                <div class="form-group">
                    <label>Kilometraje</label>
                    <input type="number" id="editVehicleMileage" required min="0">
                </div>
                <div class="form-group">
                    <label>Tipo</label>
                    <select id="editVehicleType">
                        <option value="sedan">Sed√°n</option>
                        <option value="suv">SUV</option>
                        <option value="hatchback">Hatchback</option>
                        <option value="coupe">Coup√©</option>
                        <option value="truck">Camioneta</option>
                    </select>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Guardar Cambios</button>
                    <button type="button" onclick="handleDeleteVehicle()" class="btn btn-secondary"
                        style="background: #ff4757;">Eliminar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Log Modal -->
    <div id="logModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìù A√±adir Registro</h2>
                <button class="modal-close" onclick="closeModal('logModal')">‚úï</button>
            </div>
            <form id="logForm">
                <div class="form-group">
                    <label>Tipo</label>
                    <select id="logType">
                        <option value="mantenimiento">üîß Mantenimiento</option>
                        <option value="averia">‚ö†Ô∏è Aver√≠a</option>
                        <option value="modificacion">‚ú® Modificaci√≥n</option>
                        <option value="taller">üë®‚Äçüîß Visita al Taller</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Fecha</label>
                    <input type="date" id="logDate" required>
                </div>
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="logDescription" required rows="3" placeholder="Describe qu√© se hizo..."></textarea>
                </div>
                <div class="form-group">
                    <label>Coste (‚Ç¨)</label>
                    <input type="number" id="logCost" min="0" step="0.01" placeholder="0.00">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">A√±adir Registro</button>
            </form>
        </div>
    </div>

    <!-- Dark Mode Toggle -->
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Cambiar tema">
        üåô
    </button>

    <!-- Scripts -->
    <script src="data.js"></script>
    <script src="app.js"></script>

    <script>
        // GARAGE PRO FUNCTIONS
        
        let costsChart = null;
        let costsDistributionChart = null;
        
        // Switch Tabs
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
            
            // Load charts if costs tab
            if (tabName === 'costs') {
                setTimeout(() => {
                    loadCostsCharts();
                }, 100);
            }
        }
        
        // Load Costs Charts
        function loadCostsCharts() {
            const vehicle = state.userVehicles[currentVehicleId];
            if (!vehicle || !vehicle.history) return;
            
            // Prepare data
            const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
            const costsByMonth = new Array(12).fill(0);
            const costsByType = {
                mantenimiento: 0,
                averia: 0,
                modificacion: 0,
                taller: 0
            };
            
            vehicle.history.forEach(log => {
                if (log.cost) {
                    const date = new Date(log.date);
                    const month = date.getMonth();
                    costsByMonth[month] += parseFloat(log.cost);
                    costsByType[log.type] = (costsByType[log.type] || 0) + parseFloat(log.cost);
                }
            });
            
            // Costs over time chart
            const ctx1 = document.getElementById('costsChart');
            if (costsChart) costsChart.destroy();
            costsChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Gastos (‚Ç¨)',
                        data: costsByMonth,
                        borderColor: '#2ed573',
                        backgroundColor: 'rgba(46, 213, 115, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
            
            // Distribution chart
            const ctx2 = document.getElementById('costsDistributionChart');
            if (costsDistributionChart) costsDistributionChart.destroy();
            costsDistributionChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Mantenimiento', 'Aver√≠as', 'Modificaciones', 'Taller'],
                    datasets: [{
                        data: [
                            costsByType.mantenimiento,
                            costsByType.averia,
                            costsByType.modificacion,
                            costsByType.taller
                        ],
                        backgroundColor: ['#2ed573', '#ff4757', '#ffa502', '#5352ed']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // Update Stats
        function updateStats(vehicle) {
            // Days owned (simulated)
            const daysOwned = Math.floor(Math.random() * 365) + 100;
            document.getElementById('statDaysOwned').textContent = daysOwned;
            
            // Total cost
            let totalCost = 0;
            if (vehicle.history) {
                vehicle.history.forEach(log => {
                    if (log.cost) totalCost += parseFloat(log.cost);
                });
            }
            document.getElementById('statTotalCost').textContent = totalCost.toFixed(0) + '‚Ç¨';
            
            // Maintenance count
            const maintenanceCount = vehicle.history ? vehicle.history.filter(h => h.type === 'mantenimiento').length : 0;
            document.getElementById('statMaintenance').textContent = maintenanceCount;
            
            // Health score (based on maintenance)
            const healthScore = Math.min(100, 70 + (maintenanceCount * 5));
            document.getElementById('healthScore').textContent = healthScore + '%';
            const circle = document.getElementById('healthCircle');
            const circumference = 2 * Math.PI * 54;
            const offset = circumference - (healthScore / 100) * circumference;
            circle.style.strokeDashoffset = offset;
            
            // Generate alerts
            generateAlerts(vehicle);
        }
        
        // Generate Alerts
        function generateAlerts(vehicle) {
            const alertsSection = document.getElementById('alertsSection');
            alertsSection.innerHTML = '';
            
            const alerts = [];
            
            // Check maintenance intervals
            const maintenanceItems = [
                { name: 'Cambio de Aceite', interval: 15000, icon: 'üõ¢Ô∏è' },
                { name: 'Filtro de Aire', interval: 30000, icon: 'üí®' },
                { name: 'Pastillas de Freno', interval: 50000, icon: 'üõë' }
            ];
            
            maintenanceItems.forEach(item => {
                const nextKm = Math.ceil(vehicle.mileage / item.interval) * item.interval;
                const remaining = nextKm - vehicle.mileage;
                
                if (remaining < 1000) {
                    alerts.push({
                        type: 'urgent',
                        message: `${item.icon} ${item.name} URGENTE (${remaining} km)`
                    });
                } else if (remaining < 5000) {
                    alerts.push({
                        type: 'warning',
                        message: `${item.icon} ${item.name} pr√≥ximo (${remaining} km)`
                    });
                }
            });
            
            if (alerts.length === 0) {
                alerts.push({
                    type: 'info',
                    message: '‚úÖ Todo al d√≠a - Sin mantenimientos pendientes'
                });
            }
            
            alerts.forEach(alert => {
                const badge = document.createElement('span');
                badge.className = `alert-badge alert-${alert.type}`;
                badge.textContent = alert.message;
                badge.style.marginRight = '0.5rem';
                badge.style.marginBottom = '0.5rem';
                alertsSection.appendChild(badge);
            });
        }
        
        // Filter History
        function filterHistory() {
            const filter = document.getElementById('historyFilter').value;
            const vehicle = state.userVehicles[currentVehicleId];
            if (!vehicle || !vehicle.history) return;
            
            const filtered = filter === 'all' ? vehicle.history : vehicle.history.filter(h => h.type === filter);
            
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            
            if (filtered.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No hay registros de este tipo</p>';
                return;
            }
            
            const sorted = [...filtered].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sorted.forEach(log => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                
                let icon = 'üìù';
                if (log.type === 'mantenimiento') icon = 'üõ†Ô∏è';
                if (log.type === 'averia') icon = '‚ö†Ô∏è';
                if (log.type === 'modificacion') icon = '‚ú®';
                if (log.type === 'taller') icon = 'üë®‚Äçüîß';
                
                item.innerHTML = `
                    <div style="background: var(--bg-glass); padding: 1.5rem; border-radius: var(--radius-md); border: 1px solid var(--border);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="font-weight: 600;">${icon} ${log.type.toUpperCase()}</span>
                            <span style="font-size: 0.875rem; color: var(--text-muted);">${new Date(log.date).toLocaleDateString()}</span>
                        </div>
                        <p style="color: var(--text-secondary); margin: 0.5rem 0;">${log.description}</p>
                        ${log.cost ? `<div style="color: var(--primary); font-weight: 600; margin-top: 0.5rem;">üí∞ ${log.cost}‚Ç¨</div>` : ''}
                    </div>
                `;
                list.appendChild(item);
            });
        }
        
        // Export Garage Data
        function exportGarageData() {
            const vehicle = state.userVehicles[currentVehicleId];
            if (!vehicle) {
                alert('No hay veh√≠culo seleccionado');
                return;
            }
            
            let content = `GARAGE PRO - INFORME COMPLETO\n`;
            content += `Fecha: ${new Date().toLocaleDateString('es-ES')}\n\n`;
            content += `${'='.repeat(50)}\n\n`;
            content += `VEH√çCULO: ${vehicle.brand} ${vehicle.model} (${vehicle.year})\n`;
            content += `Kilometraje: ${vehicle.mileage} km\n\n`;
            content += `${'='.repeat(50)}\n\n`;
            
            if (vehicle.history && vehicle.history.length > 0) {
                content += `HISTORIAL (${vehicle.history.length} registros):\n\n`;
                vehicle.history.forEach(log => {
                    content += `[${new Date(log.date).toLocaleDateString()}] ${log.type.toUpperCase()}\n`;
                    content += `${log.description}\n`;
                    if (log.cost) content += `Coste: ${log.cost}‚Ç¨\n`;
                    content += `\n`;
                });
            }
            
            content += `${'='.repeat(50)}\n`;
            content += `Generado por Mec√°nico IA 24/7 - Garage PRO\n`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `garage-pro-${vehicle.brand}-${vehicle.model}-${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Datos exportados correctamente');
        }
        
        // Dark Mode Toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const btn = document.querySelector('.dark-mode-toggle');
            btn.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
        }
        
        // Override loadVehicleDashboard to add stats
        const originalLoadVehicleDashboard = loadVehicleDashboard;
        loadVehicleDashboard = function(index) {
            originalLoadVehicleDashboard(index);
            const vehicle = state.userVehicles[index];
            if (vehicle) {
                updateStats(vehicle);
                filterHistory(); // Load history in timeline
            }
        };
    </script>
</body>

</html>